import{g as r,s as f}from"./utils-Co-rGlb8.js";console.log("login.js loaded");function v(){console.log("initializeLogin called");const d=document.getElementById("login-form"),i=document.getElementById("signup-form"),o=document.getElementById("signup-modal"),u=document.getElementById("show-signup"),g=document.querySelector("#signup-modal .modal-close");if(console.log("Elements:",{loginForm:d,signupForm:i,signupModal:o,showSignup:u,modalClose:g}),!d||!i||!o||!u||!g){console.error("One or more form elements not found"),alert("Form setup error. Please contact support.");return}o.classList.remove("show"),o.style.display="none",console.log("Signup modal hidden");const p="/",n=`${p}dashboard.html`.replace("//","/");console.log("Base path:",p,"Dashboard URL:",n),u.addEventListener("click",a=>{a.preventDefault(),console.log("Show signup clicked"),o.classList.add("show"),o.style.display="flex"}),g.addEventListener("click",()=>{console.log("Modal close clicked"),o.classList.remove("show"),o.style.display="none",i.reset()}),i.addEventListener("submit",a=>{a.preventDefault(),console.log("Signup form submitted");const t=document.getElementById("signup-username")?.value.trim(),e=document.getElementById("signup-email")?.value.trim(),l=document.getElementById("signup-gender")?.value,c=parseInt(document.getElementById("signup-height")?.value,10),s=parseInt(document.getElementById("signup-weight")?.value,10);if(console.log("Signup data:",{username:t,email:e,gender:l,height:c,weight:s}),!t||!e||!l||!c||!s){console.warn("Signup validation failed: Missing fields"),alert("Please fill all fields.");return}const h=r("fitness-users")||[];if(h.find(m=>m.email===e)){console.warn("Signup failed: Email already registered"),alert("Email already registered.");return}const w={username:t,email:e,gender:l,height:c,weight:s};try{f("fitness-users",h.concat(w)),f("current-user",e),console.log("User registered:",w),console.log("localStorage:",{"fitness-users":r("fitness-users"),"current-user":r("current-user")})}catch(m){console.error("localStorage set failed:",m),alert("Failed to save user data.");return}i.reset(),o.classList.remove("show"),o.style.display="none",console.log("Attempting redirect to:",n),window.location.href=n,setTimeout(()=>{console.log("Checking redirect, current URL:",window.location.href),window.location.href.includes("dashboard.html")||(console.warn("Redirect failed, forcing to:",n),window.location.assign(n))},1e3)}),d.addEventListener("submit",a=>{a.preventDefault(),console.log("Login form submitted");const t=document.getElementById("login-username")?.value.trim(),e=document.getElementById("login-email")?.value.trim();if(console.log("Login data:",{username:t,email:e}),!t||!e){console.warn("Login validation failed: Missing fields"),alert("Please fill all fields.");return}const l=r("fitness-users")||[];if(console.log("Stored users:",l),l.find(s=>s.username===t&&s.email===e)){try{f("current-user",e),console.log("Login successful, current-user:",e),console.log("localStorage:",{"fitness-users":r("fitness-users"),"current-user":r("current-user")})}catch(s){console.error("localStorage set failed:",s),alert("Failed to save login data.");return}console.log("Attempting redirect to:",n),window.location.href=n,setTimeout(()=>{console.log("Checking redirect, current URL:",window.location.href),window.location.href.includes("dashboard.html")||(console.warn("Redirect failed, forcing to:",n),window.location.assign(n))},1e3)}else console.warn("Login failed: Invalid username or email"),alert("Invalid username or email.")})}document.addEventListener("DOMContentLoaded",()=>{console.log("DOM loaded, initializing login"),v()});
